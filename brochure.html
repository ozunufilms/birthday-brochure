<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Birthday Brochure Flipbook</title>
<style>
body, html {margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;font-family:system-ui,sans-serif;}
.book {position:relative;width:100vw;height:100vh;overflow:hidden;}
.page {position:absolute;width:100%;height:100%;top:0;left:0;display:flex;align-items:center;justify-content:center;transition: transform 0.4s ease;}
.page img {width:100%;height:100%;object-fit:contain;transition: transform 0.2s ease;touch-action:none;}
.page-counter {position:absolute;bottom:16px;width:100%;text-align:center;color:white;font-size:1rem;pointer-events:none;}
</style>
</head>
<body>

<div class="book" id="book">
  <!-- 53 pages -->
  <!-- Repeat for pages 1-53 -->
  ${Array.from({length:53},(_,i)=>`<div class="page"><img src="brochure_images/page_${i+1}.jpg"></div>`).join('')}
</div>

<div class="page-counter" id="pageCounter">Page 1 / 53</div>

<script>
const pagesEl = document.querySelectorAll('.page');
const pageCounter = document.getElementById('pageCounter');
let current = 0;

// ZOOM & PAN variables
let imgScale = 1, lastScale = 1, posX = 0, posY = 0, startX = 0, startY = 0;
let touchCount = 0;
let lastTap = 0;
let pointers = [];

function updateCounter(){ pageCounter.textContent = `Page ${current+1} / ${pagesEl.length}`; }
function img(){ return pagesEl[current].querySelector('img'); }

function showPage(index){
  pagesEl.forEach((p,i)=>{
    p.style.transform = i<index ? 'translateX(-100%)' : i===index ? 'translateX(0%)' : 'translateX(100%)';
  });
  imgScale = 1; lastScale = 1; posX = 0; posY = 0;
  img().style.transform = 'translate(0px,0px) scale(1)';
  current = index;
  updateCounter();
}

function nextPage(){ if(current<pagesEl.length-1) showPage(current+1); else window.location.href='closing.html'; }
function prevPage(){ if(current>0) showPage(current-1); }

const book = document.getElementById('book');

// TOUCH START
book.addEventListener('touchstart', e=>{
  touchCount = e.touches.length;
  if(touchCount===1){
    startX = e.touches[0].clientX - posX;
    startY = e.touches[0].clientY - posY;
  } else if(touchCount===2){
    const [t1,t2] = e.touches;
    pointers = [t1,t2];
    pointers.startDist = Math.hypot(t2.clientX-t1.clientX, t2.clientY-t1.clientY);
    pointers.startScale = imgScale;
    pointers.centerX = (t1.clientX+t2.clientX)/2;
    pointers.centerY = (t1.clientY+t2.clientY)/2;
  }
});

// TOUCH MOVE
book.addEventListener('touchmove', e=>{
  e.preventDefault();
  if(touchCount===1){
    if(imgScale>1){
      posX = e.touches[0].clientX - startX;
      posY = e.touches[0].clientY - startY;
      img().style.transform = `translate(${posX}px,${posY}px) scale(${imgScale})`;
    } else {
      const dx = e.touches[0].clientX - startX;
      if(dx>50) prevPage();
      if(dx<-50) nextPage();
    }
  } else if(touchCount===2){
    const [t1,t2] = e.touches;
    const dist = Math.hypot(t2.clientX-t1.clientX, t2.clientY-t1.clientY);
    let scale = pointers.startScale * (dist / pointers.startDist);
    // LIMIT ZOOM: min 1, max 4 for user control
    scale = Math.min(Math.max(1, scale), 4);
    imgScale = scale;

    const rect = img().getBoundingClientRect();
    const dx = pointers.centerX - rect.left - rect.width/2;
    const dy = pointers.centerY - rect.top - rect.height/2;
    const tx = posX + dx*(scale/lastScale-1);
    const ty = posY + dy*(scale/lastScale-1);
    img().style.transform = `translate(${tx}px,${ty}px) scale(${scale})`;
  }
});

// TOUCH END
book.addEventListener('touchend', e=>{
  lastScale = imgScale;
  if(imgScale===1){ posX=0; posY=0; img().style.transform='translate(0px,0px) scale(1)'; }

  // DOUBLE TAP
  const now = Date.now();
  if(now - lastTap < 300){
    if(imgScale===1){
      imgScale = 2;
      img().style.transform = `translate(0px,0px) scale(2)`;
    } else {
      imgScale = 1; posX=0; posY=0;
      img().style.transform = `translate(0px,0px) scale(1)`;
    }
  }
  lastTap = now;
});

showPage(0);
</script>
</body>
</html>
